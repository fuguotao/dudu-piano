<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <script src="js/jquery-3.2.1.min.js"></script>
  <title>dudu piano</title>
</head>
<body>
<div id="dudu"></div>
<script>
  function log(value) {
    console.log(value)
    $("#dudu").append(value)
  }

  var index = index || {}
  index.altIsDown = false
  index.ctrlIsDown = false
  index.shiftIsDown = false
  index.keyNum = {
    "`": 1,
    "TAB": 3,
    "CAPSLOCK": 5,
    "Z": 6,
    "X": 8,
    "C": 10,
    "V": 11,
    "B": 13,
    "N": 15,
    "M": 17,
    ",": 18,
    ".": 20,
    "/": 22,
    "A": 23,
    "S": 25,
    "D": 27,
    "F": 29,
    "G": 30,
    "H": 32,
    "J": 34,
    "K": 35,
    "L": 37,
    ";": 39,
    "Q": 41,
    "W": 42,
    "E": 44,
    "R": 46,
    "T": 47,
    "Y": 49,
    "U": 51,
    "I": 53,
    "O": 54,
    "P": 56,
    "1": 58,
    "2": 59,
    "3": 61,
    "4": 63,
    "5": 65,
    "6": 66,
    "7": 68,
    "8": 70,
    "9": 71,
    "0": 73,
    "-": 75,
    "=": 77,
    "BACKSPACE": 78,
    "[": 80,
    "]": 82,
    "\\": 83,
    "'": 85,
    "ENTER": 87
  }
  index.tuneKey = {
    "5----": "`",
    "6----": "TAB",
    "7----": "CAPSLOCK",
    "1---": "Z",
    "2---": "X",
    "3---": "C",
    "4---": "V",
    "5---": "B",
    "6---": "N",
    "7---": "M",
    "1--": ",",
    "2--": ".",
    "3--": "/",
    "4--": "A",
    "5--": "S",
    "6--": "D",
    "7--": "F",
    "1-": "G",
    "2-": "H",
    "3-": "J",
    "4-": "K",
    "5-": "L",
    "6-": ";",
    "7-": "Q",
    "1": "W",
    "2": "E",
    "3": "R",
    "4": "T",
    "5": "Y",
    "6": "U",
    "7": "I",
    "1+": "O",
    "2+": "P",
    "3+": "1",
    "4+": "2",
    "5+": "3",
    "6+": "4",
    "7+": "5",
    "1++": "6",
    "2++": "7",
    "3++": "8",
    "4++": "9",
    "5++": "0",
    "6++": "-",
    "7++": "=",
    "1+++": "BACKSPACE",
    "2+++": "[",
    "3+++": "]",
    "4+++": "\\",
    "5+++": "'",
    "6+++": "ENTER"
  }
  index.playTune = function (tune) {
    if (typeof tune == "string") {//字符串,单键
//            log("string-->" + tune)
      if (0 != tune) {
        $(window).trigger('play', index.tuneKey[tune])
        log(" " + index.tuneKey[tune])
      } else {
        $(window).trigger('play', ' ')
      }
      return
    }
    if (tune.length && tune[0]) {//数组,合弦
//      log("array-->" + tune)
      log(' <span style="color:red;">{</span>')
      for (var i in tune) {
        index.playTune(tune[i])
      }
      log('<span style="color:red;">}</span> ')
      return
    }
    if (1) {//对象,几分音符
//      log("map-->" + tune)
      for (var i in tune) {
        log(' <span style="color:red;">' + i + ',</span>')
//        log(i + "<--i, tune[i]-->" + tune[i])
        setTimeout(function () {
          index.playTune(tune[i])
        }, Math.round(60000 / index.pai * i))
      }
      return
    }
  }

  $(window).on('keydown', function (event) {
//        log('keydown key-->' + event.key)
    if (index.keyNum[event.key.toUpperCase()]) {
      event.preventDefault()
      $(window).trigger("play", event.key.toUpperCase())
    }
    if (32 == event.keyCode) {//space
      event.preventDefault()
      $(window).trigger("play", " ")
    }
  })
  $(window).on('play', function (event, key) {
//        log('play    -->' + key + '<--')
    if (' ' == key) {
      setTimeout(function () {
        for (var i = 1; i <= 88; i++) {
          if (!$('#audio_' + i)[0].paused || 0 != $('#audio_' + i)[0].currentTime) {
            $('#audio_' + i)[0].pause()
            $('#audio_' + i)[0].currentTime = 0
          }
        }
      }, 200)//驻音等待时间
    } else {
      var num = index.keyNum[key]
      $('#audio_' + num)[0].currentTime = 0
      $('#audio_' + num)[0].pause()
      $('#audio_' + num)[0].play()
    }
  })
  $(document).ready(function () {
    for (var i = 1; i <= 88; i++) {
      var id = 'audio_' + i
      var src = 'audio/' + i + '.mp3'
      var ele = '<audio id="' + id + '" src="' + src + '" preload="auto"></audio>'
      $('body').append(ele)
    }

    index.start = function () {
      var ptr = 0;
      var tunes = index.tunes

      return function () {
        if (ptr >= tunes.length) {
          clearInterval(index.interval)
          return //
        }
        if (' ' != tunes[ptr]) {
          index.playTune(tunes[ptr])
        }
        ptr++
        if (ptr % 16 == 0) {//2个8拍
          log('<br>')
        }
      }
    }()

    index.timeout = setTimeout(function () {
      index.interval = setInterval(function () {
        index.start();
      }, Math.round(60000 / index.pai))
    }, 2000)
  })

  index.tunes = [
    //1
    '1-',
    '1',
    '3',
    '5',
    '5--',
    '5-',
    '7-',
    '2',
    '6--',
    '6-',
    '1',
    '3',
    '3--',
    '3-',
    '5-',
    '7-',
    //5
    '4--',
    '4-',
    '6-',
    '1',
    '1--',
    '1-',
    '3-',
    '5-',
    '4--',
    '4-',
    '6-',
    '1',
    '5--',
    '5-',
    '7-',
    '2',
    //9
    '3+',
    '1',
    '3',
    '5',
    '2+',
    '5-',
    '7-',
    '2',
    '1+',
    '6-',
    '1',
    '3',
    '7',
    '3-',
    '5-',
    '7-',
    //13
    '6',
    '4-',
    '6-',
    '1',
    '5',
    '1-',
    '3-',
    '5-',
    '6',
    '4-',
    '6-',
    '1',
    '7',
    '5-',
    '7-',
    '2',
    //17
    ['3+', '1+'],
    '1',
    '3',
    '5',
    ['2+', '7'],
    '5-',
    '7-',
    '2',
    ['1+', '6'],
    '6-',
    '1',
    '3',
    ['7', '5'],
    '3-',
    '5-',
    '7-',
    //21
    ['6', '4'],
    '4-',
    '6-',
    '1',
    ['5', '3'],
    '1-',
    '3-',
    '5',
    ['6', '4'],
    '4-',
    '6-',
    '1',
    ['7', '2'],
    '5-',
    '7-',
    '2',
    //25
    ['3+', '1+', '1'],
    '1',
    '3',
    '5',
    ['2+', '7', '5'],
    '5-',
    ['4', '7-'],
    '2',
    ['1+', '6', '4'],
    '6-',
    '1',
    '3',
    ['7', '5', '3'],
    '3-',
    ['2', '5-'],
    '7-',
    //29
    ['6', '4', '1'],
    '4-',
    '6-',
    '1',
    ['5', '3', '1'],
    '1-',
    ['5', '3-'],
    '5-',
    ['6', '4'],
    '4-',
    ['6', '6-'],
    '1',
    ['7', '5', '2'],
    '5-',
    ['4', '7-'],
    '2',
    //33
    ['1+', '3', '1'],
    '1',
    ['3', '1'],
    '5',
    ['7', '5', '2'],
    '5-',
    ['7', '4', '7-'],
    '2',
    ['1+', '6', '3'],
    '6-',
    ['3+', '1'],
    '3',
    ['5+', '5', '3'],
    '3-',
    ['5', '2', '5-'],
    '7-',
    //37
    ['6', '4', '1'],
    '4-',
    ['4', '6-'],
    '1',
    ['5', '3', '1'],
    '1-',
    ['5', '3', '3-'],
    '5-',
    ['4', '1'],
    '4-',
    ['1+', '6', '6-'],
    '1',
    ['2+', '5', '2', {0.25: '1+'}, {0.5: '2+'}, {0.75: '1+'}],
    ['5-', {0.25: '1+'}, {0.5: '2+'}, {0.75: '1+'}],
    ['4', '7-'],
    ['7', '2'],
    //41 start
    ['1+', '3', '1'],
    ['7', '1'],
    ['1+', '3', '1'],
    ['1', '5'],
    ['5', '2', '7-'],
    ['5', '5-'],
    ['7', '4', '2', '7-'],
    ['3', '2'],
    ['1+', '3', '1'],
    ['1+', '6-'],
    ['3+', '7', '1'],
    ['6', '3'],
    ['5+', '7', '3'],
    ['3+', '3-'],
    ['5+', '5', '2', '5-'],
    ['6+', '7-'],
    //45
    ['4+', '6', '1'],
    ['3+', '4-'],
    ['2+', '4', '6-'],
    ['4+', '1'],
    ['3+', '5', '1'],
    ['2+', '1-'],
    ['1+', '5', '3', '3-'],
    ['7', '5-'],
    ['6', '4', '1'],
    ['5', '4-'],
    ['1+', '6', '4', '6-'],
    ['3', '1'],
    ['2+', '5', '2', {0.25: '1+'}, {0.5: '2+'}, {0.75: '1+'}],
    ['4', '3', '7-'],
    ['7', '2'],
    //49
    ['1+', '3', '1'],
    ['7', '2', '1'],
    ['1+', '3', '1'],
    ['4', '1', '5'],
    ['5', '2', '7-'],
    ['5', '2', '5-'],
    ['7', '5', '2', '7-'],
    ['4', '3', '2'],
    ['1+', '3', '1'],
    ['1+', '6', '6-'],
    ['3+', '7', '5', '1'],
    ['6', '4', '3'],
    ['5+', '7', '5'],
    ['3+', '4', '3-'],
    ['5+', '5', '3', '5-'],
    ['6+', '2', '7-'],
    //53
    ['4+', '6', '1'],
    ['3+', '4-', '6-'],
    ['2+', '6', '4', '6-'],
    ['4+', '7', '1'],
    ['3+', '1+', '5'],
    ['2+', '7', '1-'],
    ['1+', '6', '3', '3-'],
    ['7', '5', '5-'],
    ['6', '4', '1'],
    ['5', '3', '4-'],
    ['1+', '4', '2', '6-'],
    ['6', '3', '1'],
    ['2+', '5', '2', {0.25: '1+'}, {0.5: '2+'}, {0.75: '1+'}],
    ['2+', '6', '4', {0.25: '1+'}, {0.5: '2+'}, {0.75: '1+'}],
    ['5', '3', '7-'],
    ['7', '4', '2'],
    //57
    ['1+', '3', '1'],
    ['7', '2', '1'],
    ['3+', '1+', '3'],
    ['5', '4', '1'],
    ['2+', '5', '7-'],
    ['5', '2', '5-'],
    ['5', '2', '7-'],
    ['4', '3', '2'],
    ['3', '1'],
    ['1+', '6', '6-'],
    ['1+', '7', '5', '1'],
    ['6', '4', '3'],
    ['3+', '7', '5'],
    ['3+', '4', '3-'],
    ['5+', '3', '5-'],
    ['6+', '2', '7-'],
    //61
    ['6+', '4+', '1'],
    ['3+', '6-', '4-'],
    ['2+', '6', '6-'],
    ['4+', '7', '1'],
    ['5+', '3+', '1+'],
    ['2+', '7', '1-'],
    ['1+', '6', '3-'],
    ['7', '5', '5-'],
    ['6+', '6', '4'],
    ['5', '3', '4-'],
    ['4', '2', '6-'],
    ['6', '3', '1'],
    ['7+', '5', '2'],
    ['6', '4', '5-'],
    ['5', '3', '7-'],
    ['4', '2'],
    //65
    ['1++', '3', '3'],
    ['2', '1'],
    ['3+', '1+', '3'],
    ['5', '4'],
    ['2+', '7', '5'],
    ['2', '5-'],
    ['5', '7-'],
    ['4', '2'],
    '3',
    ['6', '6-'],
    ['1+', '6', '5', '1'],
    ['4', '3'],
    ['3+', '1+', '5'],
    ['4', '3-'],
    ['3', '5-'],
    ['2', '7-'],
    //69
    ['6+', '3', '1'],
    ['6-', '4-'],
    ['6', '6-'],
    ['7', '1'],
    ['5+', '1+'],
    ['7', '1-'],
    ['1+', '6', '3-'],
    ['5', '5-'],
    ['6+', '1+', '4'],
    ['3', '4-'],
    ['4+', '2', '6-'],
    ['6', '1'],
    ['7+', '2+', '5'],
    ['6', '5-'],
    ['5+', '5', '7-'],
    ['4', '2'],
    //73
    ['1++', '5+', '3'], //1
    ['3+', '1', {0.5: '4+'}],
    ['5+', '3+', '1+', '3'],  //3
    ['3+', '5', {0.5: '4+'}],
    ['5+', '2+', '7', {0.5: '5'}],  //5
    ['6', '5-', {0.5: '7'}],
    ['1+', '7-', {0.5: '2+'}],  //7
    ['3+', '2', {0.5: '4+'}],
    ['3+'], //1
    ['1+', '6-', {0.5: '2+'}],
    ['3+', '1+', '6', '1'],  //3
    ['3', {0.5: '4'}],
    ['3+', '1+', '5', {0.5: '6'}],  //5
    ['5', '3-', {0.5: '4'}],
    ['5', '5-', {0.5: '3'}],  //7
    ['4', '7-', {0.5: '5'}],
    //77
    ['6+', '1+', '4'], //1
    ['6', '4-', {0.5: '5'}],
    ['4', '6-'],  //3
    ['3', '1', {0.5: '2'}],
    ['5+', '3', {0.5: '2'}],  //5
    ['1', '1-', {0.5: '2'}],
    ['2+', '3', '3-', {0.5: '4'}],  //7
    ['5', '5-', {0.5: '6'}],
    ['6+', '1+', '4'], //1
    ['6', '4-', {0.5: '5'}],
    ['4+', '6', '6-'],  //3
    ['7', '1', {0.5: '1+'}],
    ['7+', '2+', '5', {0.5: '6'}],  //5
    ['7', '5-', {0.5: '1+'}],
    ['5+', '2+', '7-', {0.5: '3+'}],  //7
    ['4+', '2', {0.5: '5+'}],
    //81
    ['1++', '5+', '3+'], //1
    ['3+', '1+', {0.5: ['4+', '2+']}],
    ['5+', '3+', '1+', '3'],  //3
    ['3+', '2+', '5', {0.5: ['4+', '1+']}],
    ['5+', '2+', '7', {0.5: ['7', '5']}],  //5
    ['1+', '6', '5-', {0.5: ['2+', '7']}],
    ['3+', '1+', '7-', {0.5: '2+'}],  //7
    ['3+', '1+', '2', {0.5: ['4+', '7']}],
    ['3+', '1+'], //1
    ['1+', '6', '6-', {0.5: ['2+', '7']}],
    ['3+', '1+', '6', '1'],  //3
    ['3', '1', {0.5: ['4', '2']}],
    ['1+', '5', '3', {0.5: ['6', '4']}],  //5
    ['5', '3', '3-', {0.5: ['4', '2']}],
    ['5', '3', '5-', {0.5: ['1+', '3']}],  //7
    ['7', '4', '7-', {0.5: ['1+', '5']}],
    //85
    ['1+', '6', '4'], //1
    ['1+', '6', '4-', {0.5: ['7', '5']}],
    ['6', '4', '6-'],  //3
    ['5', '3', '1', {0.5: ['4', '2']}],
    ['5', '3', {0.5: ['4', '2']}],  //5
    ['3', '1', '1-', {0.5: ['4', '2']}],
    ['1+', '5', '3', '3-', {0.5: ['6', '4']}],  //7
    ['7', '5', '5-', {0.5: ['1+', '6']}],
    ['1+', '6', '4'], //1
    ['1+', '6', '4-', {0.5: ['7', '5']}],
    ['4+', '1+', '6', '6-'],  //3
    ['7', '1', {0.5: ['1+', '6']}],
    ['2+', '7', '5', {0.5: ['1+', '6']}],  //5
    ['2+', '7', '5-', {0.5: '1+'}],
    ['5+', '2+', '7', '7-', {0.5: ['3+', '1+']}], //7
    ['4+', '6', '2', {0.5: ['5+', '7']}],
    //89
    ['5+', '3+', '1+'], //1
    ['3+', '1+', '1', {0.5: ['4+', '2+']}],
    ['5+', '3+', '3'],  //3
    ['3+', '2+', '5', {0.5: ['4+', '1+']}],
    ['5+', '2+', '7', {0.5: ['7', '5']}],  //5
    ['1+', '6', '5-', {0.5: ['2+', '7']}],
    ['3+', '1+', '7-', {0.5: '2+'}],  //7
    ['3+', '1+', '2', {0.5: ['4+', '7']}],
    ['3+', '1+', '6'], //1
    ['1+', '6', '6-', {0.5: ['2+', '7']}],
    ['3+', '1+', '1'],  //3
    ['3', '1', {0.5: ['4', '2']}],
    ['1+', '5', '3', {0.5: ['6', '4']}],  //5
    ['5', '3', '3-', {0.5: ['4', '2']}],
    ['5', '3', '5-', {0.5: ['1+', '3']}], //7
    ['7', '4', '7-', {0.5: ['1+', '5']}],
    //93
    ['1+', '6', '1'], //1
    ['1+', '6', '4-', {0.5: ['7', '5']}],
    ['6', '4', '6-'],  //3
    ['5', '3', '1', {0.5: ['4', '2']}],
    ['5', '3', '1', {0.5: ['4', '2']}],  //5
    ['3', '1', '1-', {0.5: ['4', '2']}],
    ['5', '3', '3-', {0.5: ['6', '4']}],  //7
    ['7', '5', '5-', {0.5: ['1+', '6']}],
    ['6', '4', '1'], //1
    ['1+', '6', '4-', {0.5: ['7', '5']}],
    ['1+', '6', '6-'],  //3
    ['7', '1', {0.5: ['1+', '6']}],
    ['7', '5', '2', {0.5: ['1+', '6']}],  //5
    ['2+', '7', '5-', {0.5: '1+'}],
    ['2+', '7', '7-', {0.5: ['3+', '1+']}], //7
    ['4+', '6', '2', {0.5: ['5+', '7']}],
    //end
    ' ', ' ', ' ', ' ', ' ', ' ', ' ', '0'
  ];
  index.pai = 168 //节拍数

</script>
</body>
</html>
